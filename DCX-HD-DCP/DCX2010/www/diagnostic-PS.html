<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="content-type" content="text/html;charset=utf-8" /> 
<title>BRANSON DCX GUI</title>
<link href="styleDCXHD-v1.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]><link href="ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if IE 7]><link href="ie7.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if IE 6]>
<script src="DD_belatedPNGDCXHD-v1.js"></script>
<script>
  /* EXAMPLE */
  DD_belatedPNG.fix('#headerLogo');
  
  
  /* string argument can be any CSS selector */
  /* .png_bg example is unnecessary */
  /* change it to what suits you! */
</script>
<![endif]-->
<style>
.divClass
{
    height:12px;
    width:6px; 
    background-color:gray;
    margin-bottom:4px;
    border: 0px;
}
.divClassSegOn
{
    height:12px;
    width:6px; 
    background-color:blue;
    margin-bottom:4px;
    border: 0px;
}
.labelBar {
	width: 100px;
	padding: 2px 2px 2px 2px;
	background: #ffffff;
	border: solid 1px #CCCCCC;
	margin: 11px 10px 0px 10px;
	float: left;
	text-align: right;
}
</style>
</head>
<script language="javascript"  type="text/javascript">
var userbranson = "1", usermf1 = "3", usermf2 = "4";
var tab1 = "<li><a href=\"javascript:GetLanguageAndUserID('ip-setup.html')\">IP Setup</a></li>";
var tab2 = "<li><a  href=\"javascript:GetLanguageAndUserID('weld-preset.html')\">Weld Preset</a></li>";
var tab3 = "<li><a  href=\"javascript:GetLanguageAndUserID('advanced-preset.html')\">Advanced Preset</a></li>";
var tab4 = "<li><a  href=\"javascript:GetLanguageAndUserID('diagnostic-IO.html')\">I/O Diagnostics</a></li>";
var tab5 = "<li class=\"active\"><a href=\"#\">P/S Diagnostics</a></li>";
var tab6 = "<li><a  href=\"javascript:GetLanguageAndUserID('system-information.html')\">System Information</a></li>";
var tab7 = "<li><a  href=\"javascript:GetLanguageAndUserID('IO-configuration.html')\">I/O Configuration</a></li>";
var tab8 = "<li><a  href=\"javascript:GetLanguageAndUserID('event-log.html')\">Event Log</a></li>";
var tab9 = "<li><a  href=\"javascript:GetLanguageAndUserID('alarm-log.html')\">Alarm Log</a></li>";
var tab10 = "<li><a  href=\"javascript:GetLanguageAndUserID('manufacturing.html')\">Manufacturing</a></li>";
var tab11 = "<li><a  href=\"javascript:GetLanguageAndUserID('mfboardtest.html')\">Manufacturing Board Test</a></li>";
var tab12 = "<li><a  href=\"javascript:GetLanguageAndUserID('HD-param.html')\">HD Parameters</a></li>";


var tabBranson = tab1 + tab2 + tab3 + tab4 + tab5 + tab6 + tab7 + tab8 + tab9 + tab12;
var tabMf = tab1 + tab2 + tab3 + tab4 + tab5 + tab6 + tab7 + tab8 + tab9 + tab10;
var tabBoardtest = tab1 + tab2 + tab3 + tab11 + tab4 + tab5 + tab6 + tab7 + tab8 + tab9;
var TabArr =["", tabBranson, "", tabMf, tabBoardtest];
var UserArr=["", "Current User: Branson", "","Current User: Manufacturing","Current User: Manufacturing"];
var txtStartTest = "     Start Test    ";
var txtStopTest = "     Stop Test     ";
function getHTTPObject() {
  var xmlhttp; 
  if (!xmlhttp && typeof XMLHttpRequest != 'undefined') {
    try {
      xmlhttp = new XMLHttpRequest();
    } catch (e) {
      xmlhttp = false;
    }
  }
  return xmlhttp;
}

var http = getHTTPObject(); // create the HTTP Object

var TestStartTimeout = 6;//3 seconds
var TestPollTimeOut = 2;//1 to 1.5 seconds
var TestStopTimeout = 6;//3 seconds
var TestResultTimeOut = 6;//3 secs

var ScanStartTimeOut = 6;//3 secs
var ScanPollTimeOut = 2;
var ScanAbortTimeOut = 6;//3 secs
var DiagPSTimeOut = 2
var timerid = 0;
var state = 0;
var missedCount = 0;
var missedCountMax = 20;
var TEST_START = 1, WAIT_TEST_START = 2, TEST_POLL =3, WAIT_TEST_POLL = 4, TEST_POLL_TIMEOUT = 5, WAIT_TEST_STOP = 6, 
TEST_RESULT = 7, WAIT_TEST_RESULT = 8, SCAN_START = 9,
 WAIT_SCAN_START = 10, SCAN_POLL = 11, WAIT_SCAN_POLL = 12, SCAN_POLL_TIMEOUT = 13,SCAN_ABORT = 14, WAIT_SCAN_ABORT = 15;
var DIAG_PS_POLL = 16, WAIT_DIAG_PS_POLL = 17, DIAG_PS_POLL_TIMEOUT = 18;
 var stateError = 0, stateWait = 1,	stateSeek = 2, stateRun = 3;
     
var msCount;
function TimerCallBack()
{   
   switch(state)
   {
    case TEST_START:
        missedCount = 0;
        msCount = TestStartTimeout;
        state = WAIT_TEST_START;
        break;
    case WAIT_TEST_START:
        if(--msCount <= 0)
        {
            state = DIAG_PS_POLL_TIMEOUT;
           /* clearInterval(timerid);*/
            TimeOutAlert("Test Start Command Not responded");
        }
        break;
     case TEST_POLL:
     SendTestPollCommand("func=13cmd=10?param=");
     mscount = TestPollTimeOut;
     state = WAIT_TEST_POLL;
     break;
     case WAIT_TEST_POLL:
     if(--msCount <= 0)
     {
        missedCount++;
        if(missedCount >= missedCountMax)
        {
            TimeOutAlert("Test Poll Command Not responded");
            EnableDiv();
            missedCount = 0;
            state = DIAG_PS_POLL_TIMEOUT;
        }
        else
            state = TEST_POLL;  
       /* clearInterval(timerid);*/
     }
     break;
     case TEST_POLL_TIMEOUT:
     if(--msCount <= 0)
     {  
        state = TEST_POLL;
     }
     break;
     case WAIT_TEST_STOP:
     if(--msCount <= 0)
     {
        state = DIAG_PS_POLL_TIMEOUT;
       /* clearInterval(timerid);*/
        TimeOutAlert("Test Stop Command Not responded");
     }
     break;    
     case TEST_RESULT:
     SendTestPollCommand("func=13cmd=12?param=")
     msCount = TestResultTimeOut;
     state = WAIT_TEST_RESULT;
     break;
     case WAIT_TEST_RESULT:
     if(--msCount <= 0)
     {
        state = DIAG_PS_POLL_TIMEOUT;
        missedCount = 0;
        /*clearInterval(timerid);*/
        TimeOutAlert("Test Result Command Not responded");
     }
     break;
     case SCAN_START:
     msCount = ScanStartTimeOut;
     state = WAIT_SCAN_START;   
     break;
     case WAIT_SCAN_START:
     if(--msCount <= 0)
     {
        state = DIAG_PS_POLL_TIMEOUT;
        missedCount = 0;
      /*  clearInterval(timerid);*/
        TimeOutAlertScan("Scan Start Command Not responded");
     }
     break;
     case SCAN_POLL:
     SendScanPollCommand();
     mscount = ScanPollTimeOut;
     state = WAIT_SCAN_POLL;
     break;
     case WAIT_SCAN_POLL:
     if(--msCount <= 0)
     {
        missedCount++;
        if(missedCount >= missedCountMax)
        {
            TimeOutAlertScan("Scan Poll Command Not responded");
            EnableDiv();
            missedCount = 0;
            state = DIAG_PS_POLL_TIMEOUT;
        }
        else
            state = SCAN_POLL;
       /* clearInterval(timerid);*/
        
     }
     break;
     case SCAN_POLL_TIMEOUT:
     if(--msCount <= 0)
     {
        state = SCAN_POLL;
     }
     break;
     case SCAN_ABORT:
     msCount = ScanAbortTimeOut;
     state = WAIT_SCAN_ABORT;
     break;
     case WAIT_SCAN_ABORT:
     if(--msCount <= 0)
     {
        state = DIAG_PS_POLL_TIMEOUT;
        missedCount = 0;
        /*clearInterval(timerid);*/
        TimeOutAlertScan("Scan Abort Command Not responded");
     }
     break;    
     case DIAG_PS_POLL: 
        msCount = DiagPSTimeOut;
        SendDiagnosticPoll();
        state = WAIT_DIAG_PS_POLL;       
     break;
     case WAIT_DIAG_PS_POLL:
        if(--msCount <= 0) 
        {    
           missedCount++;
           if(missedCount >= missedCountMax)
           {
              missedCount = 0;
              EnableDiv();
           }
           state = DIAG_PS_POLL;
           msCount = DiagPSTimeOut;                       
        }
     break;
     case DIAG_PS_POLL_TIMEOUT:  
     if(--msCount <= 0) 
        state = DIAG_PS_POLL;   
     break;      
   }
}

function SendDiagnosticPoll() 
{ 
    
    var loopBackurl = "func=18cmd=0?param=";
    loopBackurl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                    + getCookie('USERID'));
	http.open("POST", loopBackurl, true);
	http.onreadystatechange = handleDiagPSPollResponse;
	http.send(null);
}

var notOK = false;
function handleDiagPSPollResponse()
{    
    if (http.readyState == 4) 
	{
	     msCount = DiagPSTimeOut;
	     if(http.responseText=="OK")
	     {	        
	        DisableDiv();	        
	        if(notOK)
	        {
	            DiagnosticPSOnLoad();
	            notOK = false;
	        }
	     }
	     else if(http.responseText== "NOTOK")	    
	     {
	        notOK = true;
	        EnableDiv();
	     }
	     missedCount = 0;
	     state = DIAG_PS_POLL_TIMEOUT;
	}
}

function ResetScanControlsToDefaults()
{
  document.getElementById('TestButton').disabled = false;  
  document.getElementById('StartHS').disabled = false;
  document.getElementById('AbortHS').disabled = false;
  var scnProgrs = document.getElementById('HSProgress');
  scnProgrs.style.width = parseInt(0) + 'px';
  //ResetFrequencyValues();
  //OffAllLedsScan();  
  
}

function handleScanResponse()
{
    if (http.readyState == 4) 
	{
	    var str = http.responseText.split("@");
	    var res = str[1].split(":");	    
 		if(res[0] == "SYSTEMBUSY")
		{	
		   /* clearInterval(timerid);*/
		    state = DIAG_PS_POLL_TIMEOUT;
		    missedCount = 0;
		    TimeOutAlertScan("Sytem is either busy or in error state");
		}
		else if(res[0] == "SCANSTARTED")
		{ 			
			state = SCAN_POLL;
			missedCount = 0;
			OffAllLedsScan();
            ResetFrequencyValues();
			document.getElementById('AbortHS').disabled = false;
			UpdateScanResult("INPROGRESS", "");						
		}
		else if(res[0] == "SCANINPROGRESS")
		{   
			msCount = ScanPollTimeOut;
			missedCount = 0;
			state = SCAN_POLL_TIMEOUT;			
			UpdateScanResult("INPROGRESS", "");
		}
		else if(res[0] == "SCANCOMPLETED")
		{
		    /*clearInterval(timerid);*/
		    missedCount = 0;
		    state = DIAG_PS_POLL_TIMEOUT;
		    UpdateScanResult("DONE", res[1]);					
		}
		else if(res[0] == "SCANABORTED")
		{
		    /*clearInterval(timerid);*/
		    missedCount = 0;
		    state = DIAG_PS_POLL_TIMEOUT;
		    UpdateScanResult("ABORTED", "");
		}
		else if(res[0] == "SCANFAILED")
		{
		    /*clearInterval(timerid);*/
		    missedCount = 0;
		    state = DIAG_PS_POLL_TIMEOUT;
		    UpdateScanResult("FAILED", "");
		}
	}
}

function TimeOutAlertScan(msg)
{
    alert(msg);
    ResetScanControlsToDefaults();   
    state = DIAG_PS_POLL_TIMEOUT;
}


function ResetControlsAfterTest(argErr)
{
   var tstButton =  document.getElementById('TestButton');
  tstButton.disabled = false;
  tstButton.value = txtStartTest;
  document.getElementById('StartHS').disabled = false;
  document.getElementById('AbortHS').disabled = false; 
     if(argErr == "ERROR")
     {  
        UpdateFrequecy("0");
        UpdateMemoryFreq("0");
     }
     UpdateAmplitude("0");
     UpdatePower("0");
}

function TimeOutAlert(msg)
{
   var tstButton =  document.getElementById('TestButton');
  
   alert(msg);
   //OffAllLeds();
   tstButton.disabled = false;
   tstButton.value = txtStartTest;
   document.getElementById('StartHS').disabled = false;
   document.getElementById('AbortHS').disabled = false;
  /* UpdateFrequecy("0");
   UpdateMemoryFreq("0");
   UpdateAmplitude("0");
   UpdatePower("0");*/
   /*memVal.style.width = 0;*/
}

function OffAllLeds()
{
    document.getElementById('imgRUN').src = "greyDot.gif";		
    document.getElementById('imgSEEK').src = "greyDot.gif";
    document.getElementById('imgTESTOK').src = "greyDot.gif";
    document.getElementById('imgTESTFAILED').src = "greyDot.gif";
}

function OffAllLedsScan()
{
    document.getElementById('imgScanDone').src = "greyDot.gif";		
    document.getElementById('imgScanFailed').src = "greyDot.gif";
    document.getElementById('imgScanAborted').src = "greyDot.gif";
}

function SetLedStatus(ID, status)
{   
    if(status == "ON")
        document.getElementById(ID).src = "greenDot.gif"
    else if(status == "OFF")
        document.getElementById(ID).src = "greyDot.gif"
}

function UpdateMemoryFreq(segMent)
{
    for(indx = 1; indx <=20 ; indx++)
    {
        var divObj = document.getElementById("Mem_seg" + indx);
        if(parseInt(segMent) == indx)    
           divObj.className = 'divClassSegOn'
        else
          divObj.className = 'divClass';
    }
}

function UpdateFrequecy(freqSeg)
{
    for(indx = 1; indx <= 20 ; indx++)
    {
        var divObj = document.getElementById("Freq_Seg" + indx);
        if(parseInt(freqSeg) >= indx)    
           divObj.className = 'divClassSegOn'
        else
          divObj.className = 'divClass';
    }
}

function UpdateAmplitude(freqSeg)
{
    for(indx = 1; indx <= 20 ; indx++)
    {
        var divObj = document.getElementById("Amp_Seg" + indx);
        if(parseInt(freqSeg) >= indx)    
           divObj.className = 'divClassSegOn'
        else
          divObj.className = 'divClass';
    }
}

function UpdatePower(freqSeg)
{
    for(indx = 1; indx <= 20 ; indx++)
    {
        var divObj = document.getElementById("Power_Seg" + indx);
        if(parseInt(freqSeg) >= indx)    
           divObj.className = 'divClassSegOn'
        else
          divObj.className = 'divClass';
    }
}

function handleResetResponse()
{
    if (http.readyState == 4) 
	{
	    if(http.responseText == "OK")
	    {
	        SetLedStatus("imgTESTFAILED", "OFF");
	    }
	    else
	        alert("Reset command not responded");
	}
}
function handleRunTestResponse()
{ 
	if (http.readyState == 4) 
	{
	    var str = http.responseText.split("@");	 
	    var res = str[1].split(":"); 	    
 		if(res[0] == "TESTSTARTED")
		{	
		    var tstButton =  document.getElementById('TestButton');
		    tstButton.value = txtStopTest;
		    
		    OffAllLeds();
            UpdateFrequecy("0");
            UpdateMemoryFreq("0");      
            UpdateAmplitude("0");      
            UpdatePower("0");
            
		    tstButton.disabled = false;
			msCount = TestPollTimeOut;
			missedCount = 0;
			state = TEST_POLL;			
			UpdateTestProgress(res[1] , false);
		}
		else if(res[0] == "SYSTEMBUSY")
		{		    
		    /*clearInterval(timerid);*/
		    state = DIAG_PS_POLL_TIMEOUT;
		    missedCount = 0;
		    TimeOutAlert("System is either busy or in error state");
		}
	}
}
function handleTestPollResponse()
{
    if (http.readyState == 4) 
	{
	    var str = http.responseText.split("@");
	    var res = str[1].split(":");
 		if(res[0] == "TESTPOLLRESPONSE")
		{
		    missedCount = 0;
		    msCount = TestPollTimeOut;
		    state = TEST_POLL_TIMEOUT;
		    UpdateTestProgress(res[1], false);
		}
		else if(res[0] == "TESTSTOPPED")
		{   
		    missedCount = 0;
		    state = TEST_RESULT;
		    UpdateTestProgress(res[1] , false);
		}
		else if(res[0] == "TESTRESULT")
		{
		    missedCount = 0;
		    state = DIAG_PS_POLL_TIMEOUT;
		    /*clearInterval(timerid);*/
		    UpdateTestProgress(res[1] , true);
		    /*TimeOutAlert("Test Stopped");*/
		}
    }	
}


function UpdateTestProgress(testRes , stopResult)
{
    /*TODO update LEds frequency memory during and after TEST
     stateError = 0, stateWait = 1,	stateSeek = 2, stateRun = 4;*/
    var res = testRes.split(",");
    switch(parseInt(res[0]))
    {
     case stateError:
     case stateWait: /*This is to handle auto reset case*/
     if(stopResult)
     {
        state = DIAG_PS_POLL_TIMEOUT;
        OffAllLeds();
        SetLedStatus("imgTESTOK", "ON");           
        UpdateFrequecy(res[1]);   
        ResetControlsAfterTest("SUCCESS");
     }
     else
     {
        state = DIAG_PS_POLL_TIMEOUT;
       /* clearInterval(timerid);*/
        OffAllLeds();
        SetLedStatus("imgTESTFAILED", "ON");
        ResetControlsAfterTest("ERROR");
      }
     break;
     /*case stateWait: 
        OffAllLeds();
        SetLedStatus("imgTESTOK", "ON");           
        UpdateFrequecy(res[1]);   
        ResetControlsAfterTest("SUCCESS"); 
     break;*/
     case stateSeek:
        SetLedStatus("imgSEEK", "ON");
        SetLedStatus("imgRUN" , "OFF");
        UpdateFrequecy(res[1]);
        UpdateAmplitude(res[3]);
        UpdatePower(res[4]);
     break;
     case stateRun:
        SetLedStatus("imgSEEK", "OFF");
        SetLedStatus("imgRUN" , "ON");
        UpdateFrequecy(res[1]);
        UpdateAmplitude(res[3]);
        UpdatePower(res[4]);
        break;
    }
    UpdateMemoryFreq(res[2]);
  
}

function SendTestPollCommand(cmd)
{
  var postUrl;
  postUrl = cmd;
  postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                   + getCookie('USERID'));
  http.open("POST", postUrl, true);
  http.onreadystatechange = handleTestPollResponse;
  http.send(null); 
 
}

function StartTest()
{
   var stopCommand = false;
   var postUrl;
   var tstButton =  document.getElementById('TestButton');
   /*var memVal = document.getElementById('Mem_progress');*/
  /* var w  = node.style.width.match(/\d+/);*/  
   if(tstButton.value == txtStartTest)
   {
       if((state == TEST_START) || (state == WAIT_TEST_START))
        return;
      
      tstButton.disabled = true;
      //OffAllLeds();
      document.getElementById('StartHS').disabled = true;
      document.getElementById('AbortHS').disabled = true;
      /*UpdateFrequecy("0");
      UpdateMemoryFreq("0");
      UpdateAmplitude("0");
      UpdatePower("0");*/
      /*memVal.style.width = 0;*/
      postUrl = "func=13cmd=9?param=?";
      state = TEST_START;
  }
  else if(tstButton.value == txtStopTest)
  {
      if((state == WAIT_TEST_STOP) || (state == TEST_RESULT) || (state == WAIT_TEST_RESULT))
        return;
      postUrl = "func=13cmd=11?param=?"           
      msCount = TestStopTimeout;
      state = WAIT_TEST_STOP;
      stopCommand = true;
  }
  postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                   + getCookie('USERID'));
  http.open("POST", postUrl, true);
  if(stopCommand == true)
    http.onreadystatechange = handleTestPollResponse;
  else
    http.onreadystatechange = handleRunTestResponse;
  http.send(null);  
  /*if(stopCommand == false)
    timerid = setInterval("TimerCallBack()", 500);*/
}


function OnStartScan()
{
  if(state == SCAN_START)
       return;
       
  var postUrl;
  document.getElementById('TestButton').disabled = true;  
  document.getElementById('StartHS').disabled = true;
  document.getElementById('AbortHS').disabled = true;
  //OffAllLedsScan();
  //ResetFrequencyValues();
  postUrl = "func=14cmd=6?param=";
  state = SCAN_START;
  postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                   + getCookie('USERID'));
                   
  http.open("POST", postUrl, true);
  http.onreadystatechange = handleScanResponse;
  http.send(null);    
  /*timerid = setInterval("TimerCallBack()", 500);*/
}


function SendScanPollCommand()
{  
  postUrl = "func=14cmd=7?param="; 
  postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                   + getCookie('USERID'));                   
  http.open("POST", postUrl, true);
  http.onreadystatechange = handleScanResponse;
  http.send(null);      
}

function OnAbortScan()
{   

  if(state == SCAN_ABORT)
        return;
  
  if((state >= SCAN_START) && (state <= SCAN_POLL_TIMEOUT))
  {     
      postUrl = "func=14cmd=8?param="; 
      postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                       + getCookie('USERID'));                   
      http.open("POST", postUrl, true);
      http.onreadystatechange = handleScanResponse;
      state = SCAN_ABORT;
      http.send(null); 
  }
     
}
function ResetFrequencyValues()
{
    var indx;
    for(indx = 0; indx < 3 ; indx++)
    {
        document.getElementById("sfreq" + indx).innerHTML = "&nbsp";
        document.getElementById("pfreq" + indx).innerHTML = "&nbsp";
    }
}
/*to be called after/during scan*/
function UpdateScanResult(scanRes, resFreq)
{
    var indx;
    /*Update result after scan DONE*/
    if(scanRes == "DONE")
    {
        ResetScanControlsToDefaults();
        ResetFrequencyValues();
        OffAllLedsScan();
        SetLedStatus("imgScanDone" , "ON");
        document.getElementById("HSProgress").style.width = parseInt(300) + 'px';
        var freqs = resFreq.split(",");        
        var fNoS = 0, fNoP = 0;
        for(indx = 0; indx < 12 ; indx = indx + 2)
        {
            if(freqs[indx] == "1")   
            {
                if(parseInt(freqs[indx + 1]) > 0)
                {         
                    document.getElementById("sfreq" + fNoS).innerHTML = freqs[indx + 1] + "HZ";
                    fNoS++;                               
                }
            }
            else if(freqs[indx] == "2")   
            {
                if(parseInt(freqs[indx + 1]) > 0)
                {
                    document.getElementById("pfreq" + fNoP).innerHTML = freqs[indx + 1] + "HZ";
                    fNoP++;
                 }
            }
        }     
    }    
    else if(scanRes == "ABORTED")
    {
        ResetScanControlsToDefaults();
        SetLedStatus("imgScanAborted" , "ON");
        document.getElementById("HSProgress").style.width =  parseInt(0) + 'px';
        ResetFrequencyValues();
    }
    else if(scanRes == "FAILED")
    {
        ResetScanControlsToDefaults();
        SetLedStatus("imgScanFailed" , "ON");
        document.getElementById("HSProgress").style.width =  parseInt(0) + 'px';
        ResetFrequencyValues();
    }
    else if(scanRes == "INPROGRESS")
    {
        var currWidth = parseInt(document.getElementById("HSProgress").style.width);
        if(currWidth >= 300)
            currWidth = 0;
        else
            currWidth += 30;       
        document.getElementById("HSProgress").style.width = (parseInt(currWidth) + 'px');
    }
}


function getCookie(c_name)
{
if (document.cookie.length>0)
  {
  c_start=document.cookie.indexOf(c_name + "=");
  if (c_start!=-1)
    {
    c_start=c_start + c_name.length+1;
    c_end=document.cookie.indexOf(";",c_start);
    if (c_end==-1) c_end=document.cookie.length;
    return unescape(document.cookie.substring(c_start,c_end));
    }
  }
return "";
}

function GetLanguageAndUserID(hrefpage)
{
    document.getElementById("lang").value= getCookie('LANGUAGE');
	document.getElementById("userid1").value= getCookie('USERID');
	document.temp_form.action = hrefpage;
	document.temp_form.submit();        
}


function handleDiagPSLoadResponse()
{
  if (http.readyState == 4 && http.responseText.length!=0) 
  {  
    if (http.readyState == 4) 
    {   
        var i,j,results2,results3;       
       
        results = http.responseText.split("@"); 
        if((results[0] == userbranson) || (results[0] == usermf1) ||(results[0] == usermf2))
        {       
            document.getElementById('tabmenu').innerHTML = TabArr[parseInt(results[0])];                        
            document.getElementById("CurrUser").innerHTML = UserArr[parseInt(results[0])];             
        }
        else
            document.getElementById("CurrUser").innerHTML = "Current User: " + getCookie('USERID');
            
	    results2 = results[2].split(":"); 
	    if(results2[0] == "SCANCOMPLETED")
	    {
	  	    UpdateScanResult("DONE", results2[1]);	
	    }
	    else if(results2[0] == "SCANABORTED")
		{
		   UpdateScanResult("ABORTED", "");
		}
		
		if(results[1] == "READY")
            DisableDiv();
        else if(results[1] == "NOTREADY")
            EnableDiv();
        else
            EnableDiv();
        
        state = DIAG_PS_POLL;
        if(!timerid)            
            timerid = setInterval("TimerCallBack()", 500); 
         
        document.getElementById("TestButton").disabled = false;
        document.getElementById("brst").disabled = false;
        document.getElementById("StartHS").disabled = false;
        document.getElementById("AbortHS").disabled = false;
        
	}
  }
  else if(http.readyState == 4)
    EnableDiv();
}

function DiagnosticPSOnLoad()
{
    window.history.forward(1);
    var DiagPSOnLoadUrl = "func=17cmd=0?param=";   
    var postUrl = DiagPSOnLoadUrl;
    postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                   + getCookie('USERID'));
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleDiagPSLoadResponse;
    http.send(null);
}

function SendResetCmd()
{
    postUrl = "func=16cmd=0?param=";   
    postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                       + getCookie('USERID'));
                       
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleResetResponse;
    http.send(null);    
}

function EnableDiv()
{
     document.getElementById('fade_div').style.display = 'block';
    document.getElementById('info_div').style.display = 'block';
    document.getElementById('fade_div').style.width = screen.width - 30;
    var temp = (parseInt(document.getElementById('fade_div').style.width)
    - parseInt(document.getElementById('info_div').style.width)) / 2;
        
    document.getElementById('info_div').style.left = temp + "Px";
}

function DisableDiv()
{
    document.getElementById('fade_div').style.display = 'none';
    document.getElementById('info_div').style.display = 'none';
}
function GetUserManual(hrefpage)
{
    window.open(hrefpage);
}
</script>
<body onload = "DiagnosticPSOnLoad()">
<div id="fade_div" style="width:840px;height:630px;filter:alpha(opacity=50);background-color:#FFFFFF;margin-left:0px;margin-top:210px;z-index:100;display:none;position:absolute">
<table summary="" border="0" height="600px" width="1100px">
		<tr><td style="height:600px;width:1100px">&nbsp;</td></tr>
	</table>
</div>

<div id="info_div" style="display:none;position:absolute;width:250px;height:80px; z-index:102;left:435px;top:450px;">
	<table summary="" cellspacing="3" border="0" style="background-color:#000000;width:250px;height:80px;">
		<tr>
		<td>
		<table summary="" cellspacing="0" border="0" style="background-color:#FFFFFF;width:245px;height:80px;">		    
			<tr><td id="Td1" style="font-weight:bold;font-size:14pt;text-align:center">INFO : System is busy</td></tr>
		</table>
		</td>
		</tr>
	</table>
</div>
<div id="wrapper">
  <div id="header">
  	<div id="headerNav">
   	  <div id="headerLogo">
       	<!-- <img src="images/bransonLogo.png" alt="Branson" /> //-->
      </div><!-- end headerLogo //-->
      <div id="headerLinks">
      	<span class="user" id = "CurrUser">Current User: </span>  <!--<a href="javascript:GetUserManual('DCXManual.pdf')">User Manual</a> | --><a href="index.html">Logout</a>
      </div><!-- end HeaderLinks //-->
    </div><!-- end headerNav //-->
    <div id="mainNav">
    	<ul id="tabmenu">
    	    <li><a href="javascript:GetLanguageAndUserID('ip-setup.html')">IP Setup</a></li>
            <li><a href="javascript:GetLanguageAndUserID('weld-preset.html')">Weld Preset</a></li>
            <!--<li><a href="javascript:GetLanguageAndUserID('advanced-preset.html')">Advanced Preset</a></li>-->
            <li><a href="javascript:GetLanguageAndUserID('diagnostic-IO.html')">I/O Diagnostics</a></li>
            <li class="active"><a href="#">P/S Diagnostics</a></li>
            <li><a href="javascript:GetLanguageAndUserID('system-information.html')">System Information</a></li>
            <li><a href="javascript:GetLanguageAndUserID('IO-configuration.html')">I/O Configuration</a></li>
            <!--<li><a href="javascript:GetLanguageAndUserID('event-log.html')">Event Log</a></li>-->
            <li><a href ="javascript:GetLanguageAndUserID('alarm-log.html')">Alarm Log</a></li>    	  
        </ul>
    </div><!-- end mainNav //-->
  </div><!-- end header //-->
  <div id="content">
  	<div class="contentBoxWrapper">
    	<div class="contentBoxHeader">
    	<h1>Test</h1>
    	</div><!-- end contentBoxHeader //-->
    	<div class="gradientBox" style="padding-top:10px">
			<div class="buttonInGradient"><input name="StartTest" disabled= "disabled" type="button" class="button" value="     Start Test    " id = "TestButton" onclick = "StartTest()"/>
			<input name="RstOL" disabled= "disabled" type="button" class="button" value=" Reset Overload" id = "brst" onclick = "SendResetCmd()"/>
			</div><!-- end buttonInGradient //-->			
    		<div class="subBoxWrapper">
            	<div class="subBoxHeader">
            		Status
           		</div><!-- end subBoxHeader //-->
            	<div class="subBoxContent">
               	  <div class="checkbox" style="padding-left:20px"><img src="greyDot.gif" alt="On" id = "imgRUN"/></div><!-- end checkbox //--><div class="textLabel" style="padding-left:20px">Run</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
   				  <div class="checkbox" style="padding-left:20px"><img src="greyDot.gif" alt="On" id = "imgSEEK"/></div><!-- end checkbox //--><div class="textLabel" style="padding-left:20px">Seek</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
        		</div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
            <div class="subBoxWrapper">
            	<div class="subBoxHeader">
            		Result
           		</div><!-- end subBoxHeader //-->
            	<div class="subBoxContent">
                	<div class="checkbox"style="padding-left:20px"><img src="greyDot.gif" alt="On" id = "imgTESTOK"/></div><!-- end checkbox //--><div class="textLabelBigLeft" style="padding-left:23px">OK-Stored</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
     				<div class="checkbox"style="padding-left:20px"><img src="greyDot.gif" alt="On" id = "imgTESTFAILED"/></div><!-- end checkbox //--><div class="textLabelBigLeft" style="padding-left:23px">Overload-Cleared</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
                </div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
                <table>
                    <tr>
                        <td >
        	                <div class="ieDropFix"><div class="textLabelCenter"style="width:90px; height:16px;">Frequency</div></div><!-- end label //-->
        	            </td >
        	            <td >
        	                <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width:162px; height:16px;">
								 <div class="ieDropFix">
								 <table>
								 <tr>
								   <td>
						    <div id="Freq_Seg1" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg2" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg3" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg4" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg5" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg6" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg7" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg8" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg9" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg10" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg11" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg12" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg13" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg14" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg15" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg16" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg17" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg18" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg19" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Freq_Seg20" class = "divClass"></div>
						    </td>
						</tr>
								 </table>
								 </div>
							</div>
							</div>
				        </td>
				    </tr>
				</table>        	
        	<!-- end ieDropFix //--><div class="clearit"></div><!-- end clearit //-->
        	<!-- end label //-->
        	<table>
        	    <tr>
        	        <td>
        	            <div class="ieDropFix"><div class="textLabelCenter" style="width:90px;height:16px;">Memory</div></div>
        	        </td>
        	        <td>
        	            <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width:162px; height:16px;">
						<div class="ieDropFix">
							<table>
						<tr>
						    <td>
						    <div id="Mem_seg1" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg2" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg3" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg4" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg5" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg6" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg7" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg8" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg9" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg10" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg11" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg12" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg13" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg14" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg15" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg16" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg17" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg18" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg19" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Mem_seg20" class = "divClass"></div>
						    </td>
						</tr>
						</table>					
						</div>
						</div>
						</div>
        	        </td>
        	    </tr>
        	</table>
        	<table>
                    <tr>
                        <td >
        	                <div class="ieDropFix"><div class="textLabelCenter"style="width:90px; height:16px;">Amplitude</div></div><!-- end label //-->
        	            </td >
        	            <td >
        	                <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width:162px; height:16px;">
								 <div class="ieDropFix">
								 <table>
								 <tr>
								   <td>
						    <div id="Amp_Seg1" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg2" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg3" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg4" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg5" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg6" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg7" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg8" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg9" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg10" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg11" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg12" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg13" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg14" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg15" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg16" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg17" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg18" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg19" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Amp_Seg20" class = "divClass"></div>
						    </td>
						</tr>
								 </table>
								 </div>
							</div>
							</div>
				        </td>
				    </tr>
				</table>  
				<table>
                    <tr>
                        <td >
        	                <div class="ieDropFix"><div class="textLabelCenter"style="width:90px; height:16px;">Power</div></div><!-- end label //-->
        	            </td >
        	            <td >
        	                <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width:162px; height:16px;">
								 <div class="ieDropFix">
								 <table>
								 <tr>
								   <td>
						    <div id="Power_Seg1" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg2" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg3" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg4" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg5" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg6" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg7" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg8" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg9" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg10" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg11" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg12" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg13" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg14" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg15" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg16" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg17" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg18" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg19" class = "divClass"></div>
						    </td>
						    <td>
						    <div id="Power_Seg20" class = "divClass"></div>
						    </td>
						</tr>
								 </table>
								 </div>
							</div>
							</div>
				        </td>
				    </tr>
				</table>  
        	<!-- end ieDropFix //--><div class="clearit"></div><!-- end clearit //-->
        	<br /><br /><br /><br /><br /><br />
		</div>		
		<!-- end gradientBox //-->
		<!--<div class="contentBoxHeader">
		<br /><br />
    	&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
			<input id = "brst" name="Reset" type="button" disabled= "disabled" class="button" value="Reset" onclick = "SendResetCmd()"/>
    	</div>--><!-- end contentBoxHeader //-->
    </div><!-- end contentBoxWrapper //-->
      	<div class="contentBoxWrapper">
      	
      	
    	<div class="contentBoxHeader">
    	<h1>Horn Signature</h1>
    	</div><!-- end contentBoxHeader //-->
    	<div class="gradientBox" style="padding-top:10px;padding-bottom:0px">
			<div class="buttonInGradient"><input id = "StartHS" disabled= "disabled" name="StartScan" type="button" class="button" value="Start Horn Scan" onclick = "OnStartScan()"/>
		  <input id = "AbortHS" name="AbortScan" type="button" disabled= "disabled" class="button" value="Abort Horn Scan" onclick = "OnAbortScan()"/>
		  </div><!-- end buttonInGradient //-->
    		<div class="subBoxWrapper">
            	<div class="subBoxHeader">
            		Status
           		</div><!-- end subBoxHeader //-->
            	<div class="subBoxContent">  
            	<table style ="margin-top:10px;margin-left:3px">
            	<tr>
            	<td>
                	<div class="ieDropFix"><div style="border: 1px solid black; width:300px; height:20px;">
					<div class="ieDropFix"><div id="HSProgress" style="height:20px; width:0px; background-color:green;"/></div>
					</div>
					</div>
					</td>
					</tr>
				</table>              	
                	<div class="clearit"></div><!-- end clearit //-->
                	
     			</div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
            <div class="subBoxWrapper">
            	<div class="subBoxHeader">
            		Result
           		</div><!-- end subBoxHeader //-->
            	<div class="subBoxContent">
                	<div class="checkbox" style="padding-left:30px"><img id = "imgScanDone" src="greyDot.gif" alt="On" /></div><!-- end checkbox //--><div class="textLabel" style="padding-left:20px">Passed</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
     				<div class="checkbox" style="padding-left:30px"><img id = "imgScanFailed" src="greyDot.gif" alt="On" /></div><!-- end checkbox //--><div class="textLabel" style="padding-left:20px">Failed</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
     				<div class="checkbox" style="padding-left:30px"><img id = "imgScanAborted" src="greyDot.gif" alt="On" /></div><!-- end checkbox //--><div class="textLabel" style="padding-left:20px">Aborted</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
                </div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
                <div class="subBoxWrapper">
	            	<div class="subBoxHeader">
    	        		Parallel Resonant Points
        	   		</div><!-- end subBoxHeader //-->
            		<div class="subBoxContent">
                		<div class="textLabelBigCenter" id = "pfreq0">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
     					<div class="textLabelBigCenter" id = "pfreq1">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
                    	<div class="textLabelBigCenter" id = "pfreq2">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->                    	
                	</div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
                <div class="subBoxWrapper">
	            	<div class="subBoxHeader">
    	        		Series Resonant Points
        	   		</div><!-- end subBoxHeader //-->
            		<div class="subBoxContent">
                		<div class="textLabelBigCenter" id = "sfreq0">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
     					<div class="textLabelBigCenter" id = "sfreq1">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->
                    	<div class="textLabelBigCenter" id = "sfreq2">&nbsp</div><!-- end label //--><div class="clearit"></div><!-- end clearit //-->                    	
                	</div><!-- end subBoxContent //--></div><!-- end subBoxWrapper //-->
        	</div><!-- end gradientBox //-->
    </div><!-- end contentBoxWrapper //-->
  </div><!-- end content //-->
  <div class="clearit"></div>
  <div id="footer"><p>©2011 Branson, All Rights Reserved<br />
    <img src="Emerson-IA.jpg" alt="Emersin Industrial Automation" /></p></div><!-- end clearit //-->
</div>
<!-- end wrapper //-->
<form name="temp_form" method="post" action="diagnostic-PS.html">
<input type="hidden" name="lang" id="lang" value="" />
<input type="hidden" name="userid1" id="userid1" value="" />
</form>
</body>
</html>
