<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="content-type" content="text/html;charset=utf-8" /> 
    <title>BRANSON DCX GUI</title>
    <link href="styleDCXSRackMt-v1.css" rel="stylesheet" type="text/css" />
    <script type="text/JavaScript" language="javascript" src="jqueryDCXSRackMt-v1.js"></script>
	<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
	<!--[if IE 6]><link href="ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
	<!--[if IE 7]><link href="ie7.css" rel="stylesheet" type="text/css" /><![endif]-->
	<!--[if IE 6]>
	<script src="DD_belatedPNGDCXSRackMt-v1.js"></script>
<script>
  /* EXAMPLE */
  DD_belatedPNG.fix('#headerLogo');  
  /* string argument can be any CSS selector */
  /* .png_bg example is unnecessary */
  /* change it to what suits you! */
</script>
<![endif]-->
<style>
.divClass{
    height:12px;
    width:6px; 
    background-color:gray;
    margin-bottom:4px;
    border: 0px;
}
.divClassSegOn{
    height:12px;
    width:6px; 
    background-color:blue;
    margin-bottom:4px;
    border: 0px;
}
.labelBar {
	width: 100px;
	padding: 2px 2px 2px 2px;
	background: #ffffff;
	border: solid 1px #CCCCCC;
	margin: 11px 10px 0px 10px;
	float: left;
	text-align: right;
}
</style>
</head>
<script language="javascript" type="text/javascript">
function UseID(element) { return document.getElementById(element); }
function UseName(element){ return document.getElementsByName(element);}
var parenttype = "PS",DataSize = 5000,DefaultDataSize = 5000, PhaseLimit = 180, TempPhase,DataLength = 1000;
var Time = new Array(), Phase = new Array(), Current = new Array(), Amplitude = new Array(), Power = new Array(), PWMAmplitude = new Array(), Frequency = new Array();
var sOption = "toolbar=0, location=0, directories=0, menubar=0,";
sOption += " scrollbars=0, width=400, height=120, left=300, top=250";
var w, WeldPresetData = "", StartFreq, EndFreq,UserComment,userbranson = "1", usermf1 = "3", usermf2 = "4";
var tab1 = "<li><a href=\"javascript:GetLanguageAndUserID('ip-setup.html')\">IP Setup</a></li>";
var tab2 = "<li><a  href=\"javascript:GetLanguageAndUserID('weld-preset.html')\">Weld Preset</a></li>";
var tab3 = "<li><a  href=\"javascript:GetLanguageAndUserID('advanced-preset.html')\">Advanced Preset</a></li>";
var tab4 = "<li><a  href=\"javascript:GetLanguageAndUserID('diagnostic-IO.html')\">I/O Diagnostics</a></li>";
var tab5 = "<li class=\"active\"><a href=\"#\">Seek & </br>Weld Graphs</a></li>";
var tab6 = "<li><a  href=\"javascript:GetLanguageAndUserID('system-information.html')\">System Information</a></li>";
var tab7 = "<li><a  href=\"javascript:GetLanguageAndUserID('IO-configuration.html')\">I/O Configuration</a></li>";
var tab8 = "<li><a  href=\"javascript:GetLanguageAndUserID('event-log.html')\">Event Log</a></li>";
var tab9 = "<li><a  href=\"javascript:GetLanguageAndUserID('alarm-log.html')\">Alarm Log</a></li>";
var tab10 = "<li><a  href=\"javascript:GetLanguageAndUserID('manufacturing.html')\">Manufacturing</a></li>";
var tab11 = "<li><a  href=\"javascript:GetLanguageAndUserID('mfboardtest.html')\">Manufacturing Board Test</a></li>";
var tab12 = "<li><a  href=\"javascript:GetLanguageAndUserID('hornsignature.html')\">Horn <br/> Signature</a></li>";
var tabBranson = tab1 + tab2 + tab3 + tab4 + tab5 + tab12 + tab6 + tab8 + tab9;
var tabMf = tabBranson + tab10;
var tabBoardtest = tab1 + tab2 + tab3 + tab11 + tab4 + tab5 + tab12 + tab6 + tab8 + tab9;
var SMfTab = tab1 + tab2 + tab3 + tab4 + tab5 + tab12 + tab6 + tab7 + tab8 + tab9 + tab10 ;
var SBranson = tab1 + tab2 + tab3 + tab4 + tab5 + tab12 + tab6 + tab7 + tab8 + tab9;
var SBoardTest = tab1 + tab2 + tab3 + tab11 + tab4 + tab5 + tab12 + tab6 + tab7 + tab8 + tab9;

var TabArr = ["", tabBranson, "", tabMf, tabBoardtest];
var UserArr = ["", "Current User: Branson", "", "Current User: Manufacturing", "Current User: Manufacturing"];
function getHTTPObject() {
    var xmlhttp;
    if (!xmlhttp && typeof XMLHttpRequest != 'undefined') {
        try {
            xmlhttp = new XMLHttpRequest();
        } catch (e) {
            xmlhttp = false;
        }
    }
    return xmlhttp;
}
var http = getHTTPObject();
var datastate = 1;
var TestStartTimeout = 6;
var TestPollTimeOut = 2;
var TestStopTimeout = 6;
var TestResultTimeOut = 6;
var timerid = 0, state = 0, missedCount = 0, missedCountMax = 20;
var TEST_START = 1,WAIT_TEST_START = 2,TEST_POLL = 3,WAIT_TEST_POLL = 4,TEST_POLL_TIMEOUT = 5,WAIT_TEST_STOP = 6,TEST_RESULT = 7,WAIT_TEST_RESULT = 8;
var stateError = 0, stateWait = 1, stateSeek = 2, stateRun = 3,timeout,msCount, MaxAdcRawVal = 2047;
function TimerCallBack() {
    switch (state) {
        case TEST_START:
            missedCount = 0;
            msCount = TestStartTimeout;
            state = WAIT_TEST_START;
            break;
        case WAIT_TEST_START:
            if (--msCount <= 0) {
                state = 0;
                TimeOutAlert("Seek Start Command Not responded", 1);
            }
            break;
        case TEST_POLL:
            SendTestPollCommand("func=13cmd=10?param=");
            mscount = TestPollTimeOut;
            state = WAIT_TEST_POLL;
            break;
        case WAIT_TEST_POLL:
            if (--msCount <= 0) {
                missedCount++;
                if (missedCount >= missedCountMax) {
                    TimeOutAlert("Seek Poll Command Not responded");
                    missedCount = 0;
                    state = 0;
                }
                else
                    state = TEST_POLL;
            }
            break;
        case TEST_POLL_TIMEOUT:
            if (--msCount <= 0)
                state = TEST_POLL;
            break;
        case WAIT_TEST_STOP:
            if (--msCount <= 0) {
                state = 0;
                TimeOutAlert("Seek Stop Command Not responded");
            }
            break;
        case TEST_RESULT:
            SendTestPollCommand("func=13cmd=12?param=");
            msCount = TestResultTimeOut;
            state = WAIT_TEST_RESULT;
            break;
        case WAIT_TEST_RESULT:
            if (--msCount <= 0) {
                state = 0;
                missedCount = 0;
                TimeOutAlert("Seek Result Command Not responded");
            }
            break;
        default:
            state = 0;
    }
}

function StopPollingTimer() {

    if (timerid) {
        clearInterval(timerid);
        timerid = 0;
    }
}
function ResetControlsAfterTest(argErr) {
    UseID('TestButton').disabled = false;
    state = 0;
}
function TimeOutAlert(msg, errtype) {
    if (timerid) {
        clearInterval(timerid);
        timerid = 0;
    }
    alert(msg);
    UseID('TestButton').disabled = false;
    if (!errtype) {
        UpdateMemoryFreq("0", 'Freq_Seg');
        UpdateMemoryFreq("0", 'Mem_seg');
        UpdateSegments("0", 'Amp');
        UpdateSegments("0", 'Power');
        UpdateResult(",,,");
        OffAllLeds();
    }
}
function OffAllLeds() {
    UseID('imgSEEK').src = "greyDot.gif";
    UseID('imgTESTOK').src = "greyDot.gif";
    UseID('imgTESTFAILED').src = "greyDot.gif";
}
function SetLedStatus(ID, status) {
    if (status == "ON")
        UseID(ID).src = (ID == "imgTESTFAILED") ? "redDot.gif" : "greenDot.gif";
    else if (status == "OFF")
        UseID(ID).src = "greyDot.gif";
}
function UpdateMemoryFreq(SegNo, EleId) {
    for (indx = 1; indx <= 20; indx++) {
        var divObj = UseID(EleId + indx);
        if (parseInt(SegNo) == indx)
            divObj.className = 'divClassSegOn';
        else
            divObj.className = 'divClass';
    }
}
function UpdateSegments(SegNo, EleId) {
    for (indx = 1; indx <= 20; indx++) {
        var divObj = UseID(EleId + "_Seg" + indx);
        if (parseInt(SegNo) >= indx)
            divObj.className = 'divClassSegOn';
        else
            divObj.className = 'divClass';
    }
}
function handleResetResponse() {
    if (http.readyState == 4) {
        DisableDiv();
        if (http.responseText == "OK") {
            SetLedStatus("imgTESTFAILED", "OFF");
        }
        else
            alert("Reset command not responded");
    }
}
function handleRunTestResponse() {
    if (http.readyState == 4) {
        var str = http.responseText.split("@");
        var res = str[1].split(":");
        if (res[0] == "TESTSTARTED") {
            UseID("Frequency:tt").innerHTML = "";
            UseID("Memory:tt").innerHTML = "";
            UseID("Amplitude:tt").innerHTML = "";
            UseID("Power:tt").innerHTML = "";
            OffAllLeds();
            UpdateMemoryFreq("0", 'Freq_Seg');
            UpdateMemoryFreq("0", 'Mem_seg');
            UpdateSegments("0", 'Amp');
            UpdateSegments("0", 'Power');
            msCount = TestPollTimeOut;
            missedCount = 0;
            state = TEST_POLL;
            UpdateTestProgress(res[1], false);
        }
        else if (res[0] == "SYSTEMBUSY") {
            if (timerid) {
                clearInterval(timerid);
                timerid = 0;
            }
            state = 0;
            missedCount = 0;
            TimeOutAlert("System is either busy or in error state", 1);
        }
    }
}
function UpdateResult(result) {
    var finalres = result.split(",");
    UseID("Frequency:tt").innerHTML = finalres[0];
    UseID("Memory:tt").innerHTML = finalres[1];
    UseID("Amplitude:tt").innerHTML = finalres[2];
    UseID("Power:tt").innerHTML = finalres[3];
}
function handleTestPollResponse() {
    if (http.readyState == 4) {
        var str = http.responseText.split("@");
        var res = str[1].split(":");
        if (res[0] == "TESTPOLLRESPONSE") {
            UpdateResult(str[2]);
            missedCount = 0;
            msCount = TestPollTimeOut;
            state = TEST_POLL_TIMEOUT;
            UpdateTestProgress(res[1], true);
        }
        else if (res[0] == "TESTSTOPPED") {
            UpdateResult(str[2]);
            UseID('TestButton').disabled = false;
            missedCount = 0;
            state = TEST_RESULT;
            UpdateTestProgress(res[1], true);
        }
        else if (res[0] == "TESTRESULT") {
            missedCount = 0;
            state = 0;
            UpdateTestProgress(res[1], false);
        }
        else if (res[0] == "NOK") {
            SetToken(0, 0);
            alert(Notoken);
            if (timerid) {
                clearInterval(timerid);
                timerid = 0;
            }
        }
    }
}
function UpdateTestProgress(testRes, PollCmd) {
    var res = testRes.split(",");
    switch (parseInt(res[0])) {
        case stateError:
            state = 0;
            OffAllLeds();
            SetLedStatus("imgTESTFAILED", "ON");
            ResetControlsAfterTest("ERROR");
            UseID('TestButton').disabled = false;
            //if (PollCmd == false) 
            {
                StopPollingTimer();
                GetWeldData();
            }
            break;
        case stateWait:
            state = 0;
            OffAllLeds();
            SetLedStatus("imgTESTOK", "ON");
            ResetControlsAfterTest("SUCCESS");
           // if (PollCmd == false) 
            {
                StopPollingTimer();
                GetWeldData();
            }
            break;
        case stateSeek:
            SetLedStatus("imgSEEK", "ON");
            break;
    }
    UpdateMemoryFreq(res[1], 'Freq_Seg');
    UpdateMemoryFreq(res[2], 'Mem_seg');
    UpdateSegments(res[3], 'Amp');
    UpdateSegments(res[4], 'Power');
}
function SendTestPollCommand(cmd) {
    var postUrl = cmd + ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                + getCookie('USERID'));
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleTestPollResponse;
    http.send(null);
}
function StartTest() {
    if (w)
        if (!w.closed) w.window.close();
    if (!timerid)
        timerid = setInterval("TimerCallBack()", 500);
    postUrl = "func=13cmd=9?param=";
    state = TEST_START;
    postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1="
                + getCookie('USERID'));
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleRunTestResponse;
    http.send(null);
}
function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) c_end = document.cookie.length;
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}
function GetWeldData() {
    if (w)
        if (!w.closed) w.window.close();
    clearInterval(timerid);
    timerid = 0;
    UseID("Td1").innerHTML = "INFO : Getting Graph Data";
	var Commd = 0;
    EnableDiv();
    switch (datastate) {
        case 1: Commd = 36; break;
        case 2: Commd = 38; break;
        case 3: Commd = 37; break;
        case 4: Commd = 39; break;
        case 5: Commd = 40; break;
        case 6: Commd = 41; break;
        case 7: Commd = 42; break;
        case 8: Commd = 43; WeldPresetData = ""; break;
        default:
            DefaultSetting();
    }
	if (Commd != 0){
		var GetUri = "func=21" + "cmd=" + Commd + "?param=" + "&lang=" + getCookie('LANGUAGE') + "&userid1=" + getCookie('USERID');
		http.open("POST", GetUri, true);
		http.onreadystatechange = UpdateWeldData;
		http.send(null);
	}
}
function GetLanguageAndUserID(hrefpage) {
    UseID("lang").value = getCookie('LANGUAGE');
    UseID("userid1").value = getCookie('USERID');
    document.temp_form.action = hrefpage;
    document.temp_form.submit();
}
function handleDiagPSLoadResponse() {
    var i, j, results;
    if (http.readyState == 4 && http.responseText.length != 0) {
        if (http.readyState == 4) {
            results = http.responseText.split("@");
            var UserType = results[0].split("/");
			if(UserType[0] == '2'){
				tabBranson =  SBranson;
				tabBoardtest = SBoardTest;	
				tabMf = SMfTab;
				TabArr =["", tabBranson, "", tabMf, tabBoardtest];	
			}
			if((UserType[1] == userbranson) || (UserType[1] == usermf1) ||(UserType[1] == usermf2))
			{ 
				document.getElementById('tabmenu').innerHTML = TabArr[parseInt(UserType[1])];                        
				document.getElementById("CurrUser").innerHTML = UserArr[parseInt(UserType[1])];       
			}
            else{
				if(UserType[0] == '2')
					document.getElementById('tabmenu').children[6].style.display = "inline";
                UseID("CurrUser").innerHTML = "Current User: " + getCookie('USERID');
			}
            StartFreq = parseInt(results[2]);
            EndFreq = parseInt(results[3]);
			UpdateMemoryFreq(results[4],'Mem_seg');
			UseID("Memory:tt").innerHTML = results[5];
			if (results[6] == '0')
				SetLedStatus("imgTESTFAILED","ON")
            UseID("Td1").innerHTML = "INFO : Getting Graph Data";
            UseID("TestButton").disabled = false;
            DrawWeldGraph();
        }
    }
    else if (http.readyState == 4) {
        UseID("Td1").innerHTML = "INFO : System Didn't Respond";
        EnableDiv();
    }
}
function DiagnosticPSOnLoad() {
    window.history.forward(1);
    var DiagPSOnLoadUrl = "func=18cmd=0?param=";
    var postUrl = DiagPSOnLoadUrl;
    postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1=" + getCookie('USERID'));
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleDiagPSLoadResponse;
    http.send(null);
}

function SendResetCmd() {
    if (w)
        if (!w.closed) w.window.close();
    postUrl = "func=16cmd=0?param=";
    postUrl += ("&lang=" + getCookie('LANGUAGE') + "&userid1=" + getCookie('USERID'));
    http.open("POST", postUrl, true);
    http.onreadystatechange = handleResetResponse;
    http.send(null);
}
function EnableDiv() {
    var fade_height = $('#content').outerHeight() + 150;
	var fade_width = $('#content').outerWidth() + 50;
	window.scrollTo(0, 220);
    $('#fade_div').css('display','block');
    $('#info_div').css('display','block');
    $('#fade_div').css('height',fade_height);
	$('#fade_div').width(fade_width);	
}
function DisableDiv() {
    UseID('fade_div').style.display = 'none';
    UseID('info_div').style.display = 'none';
}
function GetUserManual(hrefpage) {
    window.open(hrefpage);
}
var graph, c,xPadding,yPadding,y1Padding,DiffFreq,MaxX,MaxY,MinY,DiffCurrent,DiffTime,DiffPower,DiffCurrent,DiffAmplitude, DiffPhase,graphheight,graphwidth;
function getXPixel(val, max) {
    return ((graphwidth - xPadding) / max) * val + (xPadding * 1.5) - 145;
}
function getYPixel(val, max) {
    return graphheight - (((graphheight - yPadding) / max) * val) - yPadding;
}
function PlotGraph(c,Arr,MaxY,Color,YOffset,StartTime,Start4Freq,YPad){
	y1Padding = y1Padding + YPad;
	var Diff = MaxY / 10;           
	MaxY = MaxY + (Diff - (Diff % 10) + 10);
	c.lineWidth = 1;
	c.strokeStyle = Color;
	c.beginPath();
	c.moveTo(xPadding - y1Padding, yPadding);
	c.lineTo(xPadding - y1Padding, graphheight - yPadding);
	c.stroke();
	c.textAlign = "right";
	c.textBaseline = "middle";
	c.beginPath();
	for (var i = 0; i < MaxY - YOffset; i += Diff) {
		if (i % Diff == 0) {
			c.fillText(i + Start4Freq, xPadding - y1Padding - 5, getYPixel(i, MaxY - YOffset));
			c.moveTo(xPadding - y1Padding + 5, getYPixel(i, MaxY - YOffset));
			c.lineTo(xPadding - y1Padding, getYPixel(i, MaxY - YOffset));
		}
	}
	c.stroke();
	c.strokeStyle = Color;
	c.beginPath();
	FrequencyStep = 1;
	c.moveTo(getXPixel(0, MaxX), getYPixel(0, MaxY - YOffset));
	c.moveTo(getXPixel(0, MaxX), getYPixel(Arr[StartTime] - Start4Freq, MaxY - YOffset));
	for (var i = 1, j = StartTime; i < DataSize; i += 1, j += 1) {
		c.lineTo(getXPixel(i, MaxX / FrequencyStep), getYPixel(Arr[j] - Start4Freq, MaxY - YOffset));
	}
	c.stroke();
}
function PlotPhase(c,Arr,MaxY,Color,YOffset,Start,MOff,YPad){
	y1Padding = y1Padding + YPad;
	var temp = MaxY / 5;
	MinY = -MaxY; 
	DiffPhase = MaxY / 10;
	MaxY = MaxY + (DiffPhase - (DiffPhase % 10) + 10);
	c.lineWidth = 1;
	c.strokeStyle = "Black";
	c.beginPath();
	c.moveTo(xPadding, yPadding);
	c.lineTo(xPadding, graphheight - yPadding); 
	c.moveTo(xPadding, graphheight / 2 + 3);
	c.lineTo(graphwidth - MOff, graphheight / 2 + 3); 
	c.stroke();
	c.textAlign = "right";
	c.textBaseline = "middle";
	c.strokeStyle = Color;
	if ((MinY + MaxY) < 0)
		MaxY = -MinY;
	c.beginPath();
	for (var i = 0; i < MaxY - 2; i += DiffPhase, MinY += temp) {
		if (i % DiffPhase == 0) {
			c.fillText(MinY, xPadding - 8, getYPixel(i, MaxY));
			c.moveTo(xPadding + 2, getYPixel(i, MaxY));
			c.lineTo(xPadding - 3, getYPixel(i, MaxY));
		}
	}
	c.stroke();
	c.strokeStyle = Color;
	c.beginPath();
	FrequencyStep = 1;
	c.moveTo(getXPixel(0, MaxX), getYPixel(0, MaxY) - 207);
	c.moveTo(getXPixel(0, MaxX), getYPixel(Phase[Start] / 2, MaxY) - YOffset);
	for (var i = 1, j = Start; i <= DataSize; i += 1, j += 1)
		c.lineTo(getXPixel(i, MaxX / FrequencyStep), getYPixel(Phase[j] / 2, MaxY) - YOffset);
	c.stroke();
}
function UpdateWeldData() {
if ((http.readyState == 4) && (http.responseText.length != 0)) {
        var i, j, results;
        results = http.responseText.split(",");
        if (results[0] == "Time")
            for (i = 0; i < results.length; i++)
                Time[i] = parseFloat(results[i]);
        else if (results[0] == "Phase")
            for (i = 0; i < results.length; i++)
                Phase[i] = ((parseFloat(results[i]) * 180) / MaxAdcRawVal).toFixed(3);
        else if (results[0] == "Current")
            for (i = 0; i < results.length; i++)
                Current[i] = ((parseFloat(results[i]) > 120) ? 120 : parseFloat(results[i]));
        else if (results[0] == "Amplitude")
            for (i = 0; i < results.length; i++)
                Amplitude[i] = ((parseFloat(results[i]) > 100) ? 100 : parseFloat(results[i]));
        else if (results[0] == "Power")
            for (i = 0; i < results.length; i++)
                Power[i] = ((parseFloat(results[i]) > 120) ? 120 : parseFloat(results[i]));
        else if (results[0] == "PWMAmplitude")
            for (i = 0; i < results.length; i++)
                PWMAmplitude[i] = ((parseFloat(results[i]) > 120) ? 120 : parseFloat(results[i]));
        else if (results[0] == "Frequency") {
            for (i = 0; i < results.length; i++){  
                if(parseFloat(results[i]) < StartFreq)              
                	Frequency[i] = StartFreq;
                else if(parseFloat(results[i]) > EndFreq)
                	Frequency[i] = EndFreq;
                else
                	Frequency[i] = parseFloat(results[i]);
            }
            if ((i - 1) % 10 == 0)
                DefaultDataSize = i;
            else
                DefaultDataSize = i - (i % 10) + 10;
            DataSize = DefaultDataSize;
            if (DataSize > 5000)
                DataSize = DefaultDataSize = 5000;
            DataLength = i - 1;
        }
        else if (results[0] == "PresetData") {
            StartFreq = parseInt(results[1]);
            EndFreq = parseInt(results[2]);
			for (i = 3; i < results.length; i++)
                WeldPresetData += results[i] + ',';
        }
        datastate = datastate + 1;
        GetWeldData();
    }
}
function DisplayWeldGraphValue() {
    if (w)
        if (!w.closed) w.window.close();
    var value = parseFloat(UseID('XValue').value);
    var i;
    if (UseID('SelectedGraph').selectedIndex != 0) {
        if (value > 0 && value <= DataLength) {
            switch (UseID('SelectedGraph').selectedIndex) {
                case 1: UseID('YValue').value = Phase[value];
                    break;
                case 2: UseID('YValue').value = Current[value];
                    break;
                case 3: UseID('YValue').value = Amplitude[value];
                    break;
                case 4: UseID('YValue').value = Power[value];
                    break;
                case 5: UseID('YValue').value = PWMAmplitude[value];
                    break;
                case 6: UseID('YValue').value = Frequency[value];
                    break;
            }
        }
        else
            alert("Enter correct Time");
    }
    else
        alert("Select Graph");
}
function RedrawWeldGraph() {
    if (w)
        if (!w.closed) w.window.close();
	var NoGraphSelected = false;
	for (var i = 0; i < UseName("CB").length; i++)
		if(UseName("CB").item(i).checked == true)
			NoGraphSelected = true;
	if(NoGraphSelected == false){
		alert("Please select graph data to display");
		return;
	}
    var StartTime = parseFloat(UseID("StartTime:tt").value);
    var EndTime = parseFloat(UseID("EndTime:tt").value);
    if (StartTime < 0)
        StartTime = 0;
    if (EndTime > 5000)
        EndTime = 5000;
    UseID("StartTime:tt").value = StartTime;
    UseID("EndTime:tt").value = EndTime;
    if ((EndTime - StartTime) >= 100) {
        if ((StartTime % 10) != 0)
            UseID("StartTime:tt").value = StartTime - (StartTime % 10);
        if ((EndTime % 10) != 0)
            UseID("EndTime:tt").value = EndTime + (10 - (EndTime % 10));
        c.clearRect(0, 0, 900, 500);
        DrawWeldGraph();
    }
    else
        alert("Minimum Time difference should be of 100ms");
}
function ExportWeldDataToExcel() {
    if (!Phase[1]) {
        alert("   No Graph Data   ");
        return;
    }
    if (w)
        if (!w.closed) return;
    clearInterval(timerid);
    timerid = 0;
    w = window.open('UserComment.html', '', sOption);
    var temp = "";
    var FileHeader = "\n\nTIME(ms),CURRENT(\%),AMPLITUDE(\%),POWER(%),PWM AMPLITUDE(\%),PHASE(Degree),FREQUENCY(Hz)\n";
	temp += "\n" + WeldPresetData + FileHeader;
    for (j = 1; j < DataLength; j++) {
        if (!Frequency[j])
            break;
        temp += j + ',' + Current[j] + "," + Amplitude[j] + "," + Power[j] + "," + PWMAmplitude[j] + "," + Phase[j] + "," + Frequency[j] + "\n";
    }
    UseID("tempdata").value = temp;
}
function DrawWeldGraph() {
    UseID("Td1").innerHTML = "INFO : System is busy";
    DisableDiv();
    graph = $('#graph');
    c = graph[0].getContext('2d');
    c.clearRect(0, 0, 900, 500);
    datastate = 1;
    xPadding = 292;
    yPadding = 40;
    y1Padding = -45;
    StartTime = parseFloat(UseID("StartTime:tt").value);
    EndTime = parseFloat(UseID("EndTime:tt").value);
    DataSize = EndTime - StartTime;
    MaxX = EndTime - StartTime; 
    if ((MaxX % 10) != 0)
        MaxX = MaxX - (MaxX % 10) + 10;
    DiffTime = MaxX / 10;
    MaxX += DiffTime;
    graphheight = graph.height();
    graphwidth = graph.width();
    if (DataLength < DataSize)
        DataSize = DataLength + 1;
    c.font = '8pt arial';
    c.textAlign = "center";
    c.stroke();
    c.strokeStyle = "Black";
    c.lineWidth = 1;
    c.beginPath();
    c.moveTo(0, 0);
    c.moveTo(xPadding, graphheight - yPadding);             
    c.lineTo(graphwidth - 50, graphheight - yPadding);
    c.moveTo(xPadding, yPadding);
    c.lineTo(graphwidth - 50, yPadding);          
    c.lineTo(graphwidth - 50, graphheight - yPadding); 
    c.stroke();
    c.fillStyle = "Black";
    c.beginPath();
    c.lineWidth = .5;
    for (var i = 0, j = StartTime; i < MaxX; i += DiffTime, j += DiffTime) {
        if (i % DiffTime == 0) {
            c.fillText(j, getXPixel(i, MaxX), graphheight - yPadding + 20);
            c.moveTo(getXPixel(i, MaxX), graphheight - yPadding - 2);
            c.lineTo(getXPixel(i, MaxX), graphheight - yPadding + 3);
        }
    }
    c.stroke();
    StartTime++;
    if (UseID("Phase:cb").checked == true) 
		PlotPhase(c,Phase,PhaseLimit,'Black',207,StartTime,50,45);
	if (UseID("Current:cb").checked == true) 
		PlotGraph(c,Current,120,'Blue',8,StartTime,0,45);
    if (UseID("Amplitude:cb").checked == true)
		PlotGraph(c,Amplitude,120,'Green',8,StartTime,0,45);
    if (UseID("Power:cb").checked == true)
		PlotGraph(c,Power,120,'Red',8,StartTime,0,45);
    if (UseID("PWMAmplitude:cb").checked == true) 
		PlotGraph(c,PWMAmplitude,120,'Gray',8,StartTime,0,45);
	if (UseID("Frequency:cb").checked == true)
		PlotGraph(c,Frequency,EndFreq - StartFreq,'Purple',10,StartTime,StartFreq,45);
	y1Padding = 305;
    c.textAlign = "left";
    c.font = 'Bold 10pt sans-serif';
    c.fillText("TIME (ms)", 500, 495);
    c.rotate(-90 * Math.PI / 180);
    if (UseID("Phase:cb").checked == true) {
        y1Padding = y1Padding - 45;
        c.fillStyle = "Black";
        c.fillText("PHASE (Deg)", -300, y1Padding);
    }
    if (UseID("Current:cb").checked == true) {
        y1Padding = y1Padding - 42;
        c.fillStyle = "Blue";
        c.fillText("CURRENT (%)", -300, y1Padding);
    }
    if (UseID("Amplitude:cb").checked == true) {
        y1Padding = y1Padding - 42;
        c.fillStyle = "Green";
        c.fillText("AMPLITUDE (%)", -300, y1Padding);
    }
    if (UseID("Power:cb").checked == true) {
        y1Padding = y1Padding - 45;
        c.fillStyle = "Red";
        c.fillText("POWER (%)", -300, y1Padding);
    }
    if (UseID("PWMAmplitude:cb").checked == true) {
        y1Padding = y1Padding - 45;
        c.fillStyle = "Gray";
        c.fillText("PWM AMPLITUDE (%)", -300, y1Padding);
    }
    if (UseID("Frequency:cb").checked == true) {
        y1Padding = y1Padding - 58;
        c.fillStyle = "Purple";
        c.fillText("FREQUENCY (Hz)", -300, y1Padding);
    }
    c.rotate(90 * Math.PI / 180);
    c.stroke();
    c.strokeStyle = "Black";
    c.lineWidth = .5;
    c.beginPath();
    c.moveTo(0, 0);
    c.moveTo(xPadding, yPadding);
    c.lineTo(xPadding + 1, yPadding + 1);
    c.stroke();
}
function DefaultSetting() {
    if (w)
        if (!w.closed) w.window.close();
    UseID("Phase:cb").checked = true;
    UseID("Current:cb").checked = true;
    UseID("Amplitude:cb").checked = true;
    UseID("Power:cb").checked = true;
    UseID("Frequency:cb").checked = true;
    UseID("StartTime:tt").value = 0;
    UseID("EndTime:tt").value = DefaultDataSize;
    UseID("XValue").value = 1;
    UseID("YValue").value = 0;
    UseID('SelectedGraph').selectedIndex = 0;
    DrawWeldGraph();
}
$(document).ready(function (){
	DefaultSetting();
});
</script>
<body onload="DiagnosticPSOnLoad()">
    <div id="wrapper">
        <div id="header">
            <div id="headerNav">
                <div id="headerLogo"></div>
                <div id="headerLinks"><span class="user" id="CurrUser">Current User: </span><a href="index.html">Logout</a></div>
            </div>
            <div id="mainNav"><ul id="tabmenu" onclick="if (w) if (!w.closed) w.window.close();">
            <li><a href="javascript:GetLanguageAndUserID('ip-setup.html')">IP Setup</a></li>		
	        <li><a href="javascript:GetLanguageAndUserID('weld-preset.html')">Weld Preset</a></li>	
	        <li><a href="javascript:GetLanguageAndUserID('diagnostic-IO.html')">I/O Diagnostics</a></li>
            <li class="active"><a href="#">Seek & <br/>Weld Graphs</a></li>
            <li><a href="javascript:GetLanguageAndUserID('hornsignature.html')">Horn <br/> Signature</a></li>
	        <li><a href="javascript:GetLanguageAndUserID('system-information.html')">System Information</a></li>
			<li style="display: none"><a id="IOConfigTab"  href="javascript:GetLanguageAndUserID('IO-configuration.html')">I/O Configuration</a></li>
	        <li><a href="javascript:GetLanguageAndUserID('alarm-log.html')">Alarm Log</a></li>
             </ul></div>
        </div>
        <div id="content">
            <div id="fade_div" style="filter: alpha(opacity=50);background-color: #FFFFFF;margin-top:60px;z-index:10;display:none;position:absolute">
            </div>
            <div id="info_div" style="display:none;background-color:#FFFFFF;border:solid 2px #000000;position:absolute;width:250px;height:80px;z-index:20;left:40%;top:400px;">
                <table>
                    <tr>
                        <td id="Td1" style="font-weight: bold;font-size:14pt; text-align:center">INFO : Getting Graph Data</td>
                    </tr>
                </table>
            </div>
            <div class="contentBoxWrapper" style="width: 700px">
                <table>
                    <tr><td><div class="contentBoxHeader"><h1>Seek</h1></div>
                            <div class="gradientBox" style="padding-top: 10px">
                                <div class="buttonInGradient">
                                    <input type="button" class="button" value="     Seek    " id="TestButton" onclick="StartTest()" />
                                    <input name="RstOL" type="button" class="button" value=" Reset Overload" id="brst" onclick="SendResetCmd()" />
                                </div>
                                <div class="subBoxWrapper"><div class="subBoxHeader">Status</div>
                                    <div class="subBoxContent">
                                        <div class="checkbox" style="padding-left: 20px"><img src="greyDot.gif" alt="On" id="imgSEEK" /></div>
                                        <div class="textLabel" style="padding-left: 20px">Seek</div>
                                        <div class="clearit"></div>
                                    </div>
                                </div>
                                <div class="subBoxWrapper">
                                    <div class="subBoxHeader">Result</div>
                                    <div class="subBoxContent">
                                        <div class="checkbox" style="padding-left: 20px"><img src="greyDot.gif" alt="On" id="imgTESTOK" /></div>
                                        <div class="textLabelBigLeft" style="padding-left: 23px">OK-Memory Stored</div>
                                        <div class="clearit"></div>
                                        <div class="checkbox" style="padding-left: 20px"><img src="greyDot.gif" alt="On" id="imgTESTFAILED" /></div>
                                        <div class="textLabelBigLeft" style="padding-left: 23px">Overload-Cleared</div>
                                        <div class="clearit"></div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td><br /><br /><br /><br /><br />
                            <table>
                                <tr><td>
                                        <div class="ieDropFix"><div class="textLabelCenter" style="width: 90px; height: 16px;">Frequency</div></div>
                                    </td>
                                    <td>
                                        <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width: 162px; height: 16px;">
                                                <div class="ieDropFix">
                                                    <table>
                                                        <tr><td><div id="Freq_Seg1" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg2" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg3" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg4" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg5" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg6" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg7" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg8" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg9" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg10" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg11" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg12" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg13" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg14" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg15" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg16" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg17" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg18" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg19" class="divClass"></div></td>
                                                            <td><div id="Freq_Seg20" class="divClass"></div></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="textLabelCenter" style="width: 90px; height: 16px;" id="Frequency:tt"></div>
                                    </td>
                                </tr>
                            </table>
                            <div class="clearit"></div>
                            <table>
                                <tr><td><div class="ieDropFix"><div class="textLabelCenter" style="width: 90px; height: 16px;">Memory</div></div></td>
                                    <td><div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width: 162px; height: 16px;">
                                                <div class="ieDropFix">
                                                    <table>
                                                        <tr><td><div id="Mem_seg1" class="divClass"></div></td>
                                                            <td><div id="Mem_seg2" class="divClass"></div></td>
                                                            <td><div id="Mem_seg3" class="divClass"></div></td>
                                                            <td><div id="Mem_seg4" class="divClass"></div></td>
                                                            <td><div id="Mem_seg5" class="divClass"></div></td>
                                                            <td><div id="Mem_seg6" class="divClass"></div></td>
                                                            <td><div id="Mem_seg7" class="divClass"></div></td>
                                                            <td><div id="Mem_seg8" class="divClass"></div></td>
                                                            <td><div id="Mem_seg9" class="divClass"></div></td>
                                                            <td><div id="Mem_seg10" class="divClass"></div></td>
                                                            <td><div id="Mem_seg11" class="divClass"></div></td>
                                                            <td><div id="Mem_seg12" class="divClass"></div></td>
                                                            <td><div id="Mem_seg13" class="divClass"></div></td>
                                                            <td><div id="Mem_seg14" class="divClass"></div></td>
                                                            <td><div id="Mem_seg15" class="divClass"></div></td>
                                                            <td><div id="Mem_seg16" class="divClass"></div></td>
                                                            <td><div id="Mem_seg17" class="divClass"></div></td>
                                                            <td><div id="Mem_seg18" class="divClass"></div></td>
                                                            <td><div id="Mem_seg19" class="divClass"></div></td>
                                                            <td><div id="Mem_seg20" class="divClass"></div></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="textLabelCenter" style="width: 90px; height: 16px;" id="Memory:tt"></div>
                                    </td>
                                </tr>
                            </table>
                            <table>
                                <tr>
                                    <td><div class="ieDropFix"><div class="textLabelCenter" style="width: 90px; height: 16px;">Amplitude</div></div></td>
                                    <td><div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width: 162px; height: 16px;">
                                    <div class="ieDropFix">
                                                    <table>
                                                        <tr><td><div id="Amp_Seg1" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg2" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg3" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg4" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg5" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg6" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg7" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg8" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg9" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg10" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg11" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg12" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg13" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg14" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg15" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg16" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg17" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg18" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg19" class="divClass"></div></td>
                                                            <td><div id="Amp_Seg20" class="divClass"></div></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="textLabelCenter" style="width: 90px; height: 16px;" id="Amplitude:tt"></div>
                                    </td>
                                </tr>
                            </table>
                            <table>
                                <tr>
                                    <td><div class="ieDropFix"><div class="textLabelCenter" style="width: 90px; height: 16px">Power</div></div>
                                    </td>
                                    <td>
                                        <div class="ieDropFix"><div class="labelBar" style="border: 1px solid black; width: 162px; height: 16px;">
                                                <div class="ieDropFix">
                                                    <table>
                                                        <tr><td><div id="Power_Seg1" class="divClass"></div></td>
                                                            <td><div id="Power_Seg2" class="divClass"></div></td>
                                                            <td><div id="Power_Seg3" class="divClass"></div></td>
                                                            <td><div id="Power_Seg4" class="divClass"></div></td>
                                                            <td><div id="Power_Seg5" class="divClass"></div></td>
                                                            <td><div id="Power_Seg6" class="divClass"></div></td>
                                                            <td><div id="Power_Seg7" class="divClass"></div></td>
                                                            <td><div id="Power_Seg8" class="divClass"></div></td>
                                                            <td><div id="Power_Seg9" class="divClass"></div></td>
                                                            <td><div id="Power_Seg10" class="divClass"></div></td>
                                                            <td><div id="Power_Seg11" class="divClass"></div></td>
                                                            <td><div id="Power_Seg12" class="divClass"></div></td>
                                                            <td><div id="Power_Seg13" class="divClass"></div></td>
                                                            <td><div id="Power_Seg14" class="divClass"></div></td>
                                                            <td><div id="Power_Seg15" class="divClass"></div></td>
                                                            <td><div id="Power_Seg16" class="divClass"></div></td>
                                                            <td><div id="Power_Seg17" class="divClass"></div></td>
                                                            <td><div id="Power_Seg18" class="divClass"></div></td>
                                                            <td><div id="Power_Seg19" class="divClass"></div></td>
                                                            <td><div id="Power_Seg20" class="divClass"></div></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="textLabelCenter" style="width: 90px; height: 16px" id="Power:tt"></div>
                                    </td>
                                </tr>
                            </table>
                            <div class="clearit"></div><br /><br /><br /><br /><br /><br />
                        </td>
                    </tr>
                </table>
            </div>
        <div class="clearit"></div>
        <div id="parent" style="margin-left: 40px">
                <canvas id="graph" width="900" height="500"></canvas>
                <div class="clearit"></div>
                <div style="position: absolute; top: 1030px">
                    <div class="ieDropFix"><input type="hidden" id="" /></div>
                    <div class="checkboxLeft"><input type="checkbox" name="CB" id="Amplitude:cb"/></div>
                    <div class="textLabelBigLeft">AMPLITUDE</div>
                    <input type="hidden" id="" />
                    <div class="ieDropFix">
                        <div class="checkboxLeft">
                            <input type="checkbox" name="CB" id="Phase:cb" /></div>
                        <div class="textLabelBigLeft">PHASE</div>
                        <input type="hidden" id="tempid4" /></div>
                    <div class="ieDropFix">
                        <div class="checkboxLeft">
                            <input type="checkbox" name="CB" id="Current:cb" /></div>
                        <div class="textLabelBigLeft">CURRENT</div>
                        <input type="hidden" id="" /></div>
                    <div class="clearit"></div>
                    <div class="ieDropFix">
                        <div class="checkboxLeft"><input type="checkbox" name="CB" id="Power:cb" /></div>
                        <div class="textLabelBigLeft">POWER</div>
                        <input type="hidden" id="tempid5" /></div>
                    <div class="ieDropFix">
                        <div class="checkboxLeft"><input type="checkbox" name="CB" id="PWMAmplitude:cb" /></div>
                        <div class="textLabelBigLeft">PWM AMPLITUDE</div>
                        <input type="hidden" id="tempid6" /></div>
                    <div class="ieDropFix">
                        <div class="checkboxLeft"><input type="checkbox" name="CB" id="Frequency:cb" /></div>
                        <div class="textLabelBigLeft">FREQUENCY</div>
                        <input type="hidden" id="tempid7" /></div>
                    <br />
                    <input name="Update Graph" type="button" class="button" value="Update Graph" onclick="GetWeldData()" />
                    <input name="Export Graph" type="button" class="button" value="Export Graph Data"
                        onclick="ExportWeldDataToExcel()" />
                    <div class="clearit"></div>
                    <div class="contentBoxWrapper" style="border: 0.5px solid black; width:780px; height:100px;"
                        id="Zoom">
                        <div class="ieDropFix">
                            <div class="textLabelBigLeft" style="width: 72px; text-align:right">Draw from</div>
                            <input class="textInput" id="StartTime:tt" style="width: 50px" />
                            <div class="textLabelBigLeft" style="width: 20px">ms</div>
                            <div class="textLabelBigLeft" style="width: 20px; text-align: right">To</div>
                            <input class="textInput" id="EndTime:tt" style="width: 50px" />
                            <div class="textLabelBigLeft" style="width: 20px">ms</div>
                            <div class="textLabelBigLeft" style="width: 23px"></div>
                            <input name="Redraw Graph" type="button" class="button" value="Redraw Graph" onclick="RedrawWeldGraph()" />
                            <input name="SetDefault" type="button" class="button" value="Set Default" onclick="DefaultSetting()" />
                            <input type="hidden" id="tempid9"/></div>
                        <div class="clearit"></div>
                        <div class="ieDropFix">
                            <div class="textLabelBigLeft" style="width: 107px; text-align: right">Graph Selection</div>
                            <div class="dropdown">
                                <select id="SelectedGraph" size="width:150px">
                                    <option>Select Graph&nbsp&nbsp&nbsp</option>
                                    <option>PHASE</option>
                                    <option>CURRENT</option>
                                    <option>AMPLITUDE</option>
                                    <option>POWER</option>
                                    <option>PWM AMPLITUDE</option>
                                    <option>FREQUENCY</option>
                                </select>
                            </div>
                            <div class="textLabelBigLeft" style="width: 70px; text-align: right">X Value</div>
                            <input class="textInput" id="XValue" style="width: 50px" />
                        </div>
                        <div class="textLabelBigLeft" style="width: 70px; text-align: right">Y Value</div>
                        <input class="textInput" id="YValue" disabled="disabled" style="width: 50px" />
                        <div class="textLabelBigLeft" style="width: 40px; text-align: right"></div><br />
                        <input name="UpdateValue" type="button" class="button" value="Update Value" onclick="DisplayWeldGraphValue()" />
                    </div>
                    <input type="hidden" id="tempid10" />
                    <div class="clearit"></div>
            </div>
        </div>
        <div id="footer" style="position: absolute; top: 1260px">
            <p>©2011 Branson, All Rights Reserved<br /><img src="Emerson-IA.jpg" alt="Emersin Industrial Automation" /></p>
        </div>
    </div>
</div>
<form name="temp_form" method="post" action="Seek&WeldGraphs.html">
<input type="hidden" name="lang" id="lang"/>
<input type="hidden" name="userid1" id="userid1"/>
</form>
<form name="temp_form_test" method="post" enctype="multipart/form-data" action="Seek&WeldGraphs.html">
<input type="hidden" name="UserComment:," id="tempdata"/>
</form>
</body>
</html>
